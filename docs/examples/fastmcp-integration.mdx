---
title: "FastMCP Integration"
description: "How to use Keycard OAuth with FastMCP servers for automated token exchange"
---

# FastMCP Integration

A step-by-step guide to create an authenticated MCP server with FastMCP and Keycard.

## Quick Start

### Step 1: Create Project

```bash
uv init --package my-mcp-server
cd my-mcp-server
```

### Step 2: Install Dependencies

```bash
uv add keycardai-mcp-fastmcp fastmcp
```

### Step 3: Create Your Server

Create `src/my_mcp_server/__init__.py`:

```python
from keycardai.mcp.integrations.fastmcp import AuthProvider
from fastmcp import FastMCP

# Configure Keycard authentication
auth_provider = AuthProvider(
    zone_id="your-zone-id",  # Get this from console.keycard.ai
    mcp_server_name="My Server",
    mcp_base_url="http://localhost:8000/"
)

# Get auth provider for FastMCP
auth = auth_provider.get_remote_auth_provider()

# Create authenticated MCP server
mcp = FastMCP("My Server", auth=auth)

@mcp.tool()
def hello_world(name: str) -> str:
    """Say hello to someone."""
    return f"Hello, {name}!"

def main():
    """Entry point for the MCP server."""
    mcp.run(transport="streamable-http")
```

### Step 4: Run Your Server

```bash
uv run my-mcp-server
```

Your authenticated MCP server is now running on `http://localhost:8000`!

## Delegated Access to External APIs

To access external APIs on behalf of authenticated users, use the `@grant` decorator.

### Step 1: Configure Client Credentials

Get your client credentials from [console.keycard.ai](https://console.keycard.ai) and set them:

```bash
export KEYCARD_CLIENT_ID="your-client-id"
export KEYCARD_CLIENT_SECRET="your-client-secret"
```

### Step 2: Add Delegated Access

Update `src/my_mcp_server/__init__.py`:

```python
import os
from fastmcp import FastMCP, Context
from keycardai.mcp.integrations.fastmcp import AuthProvider, AccessContext, ClientSecret
import httpx

# Configure with client credentials for delegated access
auth_provider = AuthProvider(
    zone_id="your-zone-id",
    mcp_server_name="My Server",
    mcp_base_url="http://localhost:8000/",
    application_credential=ClientSecret((
        os.getenv("KEYCARD_CLIENT_ID"),
        os.getenv("KEYCARD_CLIENT_SECRET")
    ))
)

auth = auth_provider.get_remote_auth_provider()
mcp = FastMCP("My Server", auth=auth)

@mcp.tool()
def hello_world(name: str) -> str:
    """Say hello to someone."""
    return f"Hello, {name}!"

# Tool with delegated access to external API
@mcp.tool()
@auth_provider.grant("https://www.googleapis.com/calendar/v3")
async def get_calendar_events(ctx: Context, maxResults: int = 10) -> dict:
    """Get user's calendar events."""
    access_context: AccessContext = ctx.get_state("keycardai")
    
    if access_context.has_errors():
        return {"error": f"Token exchange failed: {access_context.get_errors()}"}
    
    # Get delegated token for Google Calendar API
    token = access_context.access("https://www.googleapis.com/calendar/v3").access_token
    
    # Call Google Calendar API on behalf of user
    async with httpx.AsyncClient() as client:
        response = await client.get(
            "https://www.googleapis.com/calendar/v3/calendars/primary/events",
            headers={"Authorization": f"Bearer {token}"},
            params={"maxResults": maxResults}
        )
        response.raise_for_status()
        return response.json()

def main():
    """Entry point for the MCP server."""
    mcp.run(transport="streamable-http")
```

### Step 3: Run with Credentials

```bash
export KEYCARD_CLIENT_ID="your-client-id"
export KEYCARD_CLIENT_SECRET="your-client-secret"
uv run my-mcp-server
```

