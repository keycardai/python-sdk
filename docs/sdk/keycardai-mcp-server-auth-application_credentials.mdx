---
title: application_credentials
sidebarTitle: application_credentials
---

# `keycardai.mcp.server.auth.application_credentials`


Application Credential Providers for Token Exchange.

This module provides a protocol-based approach for managing different types of
application credentials used during OAuth 2.0 token exchange operations. Each credential
provider knows how to prepare the appropriate TokenExchangeRequest based on its
authentication method.

Key Features:
- Protocol-based abstraction for multiple credential types
- Support for client secrets, private key JWT, and workload identities
- Extensible design for adding new credential providers (EKS, GKE, Azure, etc.)

Credential Providers:
- ClientSecret: Uses client credentials (BasicAuth) for token exchange
- WebIdentity: Private key JWT client assertion (RFC 7523)
- EKSWorkloadIdentity: EKS workload identity with mounted tokens


## Classes

### `ApplicationCredential` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L60" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Protocol for application credential providers.

Application credential providers are responsible for preparing token exchange
requests with the appropriate authentication parameters based on the workload's
credential type (none, private key JWT, cloud workload identity, etc.).

This protocol enables the provider to support multiple authentication methods
without tight coupling to specific implementations.


**Methods:**

#### `get_http_client_auth` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L71" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_http_client_auth(self) -> AuthStrategy
```

Get HTTP client authentication strategy for token exchange requests.

Returns the appropriate authentication strategy for the HTTP client that
performs token exchange. ClientSecret credentials use the configured auth
strategy (e.g., BasicAuth), while assertion-based credentials (WebIdentity,
EKSWorkloadIdentity) use NoneAuth since authentication is handled via
assertions in the request body.

**Returns:**
- AuthStrategy to use for HTTP client authentication


#### `set_client_config` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L85" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_client_config(self, config: ClientConfig, auth_info: dict[str, str]) -> ClientConfig
```

Configure OAuth client settings for this identity type.

Allows the identity provider to customize the OAuth client configuration
with identity-specific settings (e.g., JWKS URL, authentication method).

**Args:**
- `config`: Base client configuration to customize
- `auth_info`: Authentication context containing\:
      - resource_client_id\: OAuth client identifier
      - resource_server_url\: Resource server URL
      - zone_id\: Zone identifier (optional)
      Providers extract what they need from this dict

**Returns:**
- Modified ClientConfig with identity-specific settings


#### `prepare_token_exchange_request` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L108" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
prepare_token_exchange_request(self, client: AsyncClient, subject_token: str, resource: str, auth_info: dict[str, str] | None = None) -> TokenExchangeRequest
```

Prepare a token exchange request with identity-specific parameters.

**Args:**
- `client`: OAuth client for metadata lookup and token exchange
- `subject_token`: The token to be exchanged (typically access token)
- `resource`: Target resource URL for the exchanged token
- `auth_info`: Optional authentication context (zone_id, client_id, etc.)

**Returns:**
- TokenExchangeRequest configured for this identity type


### `ClientSecret` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L129" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Client secret credential-based provider.

This provider represents MCP servers that have been issued client credentials
by Keycard. It uses client_secret_basic or client_secret_post authentication
via the AuthStrategy, which is handled at the HTTP client level.

The AuthStrategy is constructed from either a simple (client_id, client_secret) tuple
for single-zone deployments, or a dict mapping zone IDs to credentials for multi-zone
deployments.


**Methods:**

#### `get_http_client_auth` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L178" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_http_client_auth(self) -> AuthStrategy
```

Get HTTP client authentication strategy.

Returns the configured auth strategy (typically BasicAuth or MultiZoneBasicAuth)
for authenticating the HTTP client during token exchange.

**Returns:**
- The configured authentication strategy


#### `set_client_config` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L189" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_client_config(self, config: ClientConfig, auth_info: dict[str, str]) -> ClientConfig
```

No additional configuration needed for client secret credentials.

Authentication is handled via AuthStrategy at the HTTP client level.

**Args:**
- `config`: Base client configuration
- `auth_info`: Authentication context (unused for this provider)

**Returns:**
- Unmodified ClientConfig


#### `prepare_token_exchange_request` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L207" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
prepare_token_exchange_request(self, client: AsyncClient, subject_token: str, resource: str, auth_info: dict[str, str] | None = None) -> TokenExchangeRequest
```

Prepare token exchange request with client secret credentials.

The client authentication is handled via the AuthStrategy at the HTTP level,
not in the token exchange request itself. This method prepares a standard
token exchange request without client assertions.

**Args:**
- `client`: OAuth client for token exchange
- `subject_token`: Access token to exchange
- `resource`: Target resource URL
- `auth_info`: Optional authentication context (unused for this provider)

**Returns:**
- TokenExchangeRequest with basic parameters


### `WebIdentity` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L236" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Private key JWT client assertion provider.

This provider implements OAuth 2.0 private_key_jwt authentication as defined
in RFC 7523. It uses a PrivateKeyManager to generate JWT client
assertions for authenticating token exchange requests.

The client assertion proves the client's identity using asymmetric cryptography,
providing stronger security than shared secrets.


**Methods:**

#### `get_http_client_auth` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L304" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_http_client_auth(self) -> AuthStrategy
```

Get HTTP client authentication strategy.

Returns NoneAuth since WebIdentity uses client assertions in the request body
(private_key_jwt) rather than HTTP client authentication.

**Returns:**
- NoneAuth instance for no HTTP client authentication


#### `set_client_config` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L315" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_client_config(self, config: ClientConfig, auth_info: dict[str, str]) -> ClientConfig
```

Configure OAuth client for private key JWT authentication.

Sets up the client configuration with:
- Client ID from resource_client_id
- JWKS URL for public key distribution
- private_key_jwt authentication method
- Disables dynamic client registration (client should be pre-registered)

**Args:**
- `config`: Base client configuration to customize
- `auth_info`: Authentication context, expects\:
      - resource_client_id\: OAuth client identifier
      - resource_server_url\: Resource server URL for JWKS endpoint

**Returns:**
- ClientConfig configured for private key JWT authentication

**Raises:**
- `KeyError`: If required fields are not in auth_info


#### `get_jwks` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L349" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_jwks(self) -> JsonWebKeySet
```

Get JWKS for public key distribution.

**Returns:**
- JsonWebKeySet containing the public keys


#### `prepare_token_exchange_request` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L357" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
prepare_token_exchange_request(self, client: AsyncClient, subject_token: str, resource: str, auth_info: dict[str, str] | None = None) -> TokenExchangeRequest
```

Prepare token exchange request with JWT client assertion.

Generates a JWT client assertion signed with the private key and includes
it in the token exchange request for client authentication.

**Args:**
- `client`: OAuth client for metadata lookup
- `subject_token`: Access token to exchange
- `resource`: Target resource URL
- `auth_info`: Must contain "resource_client_id" for JWT issuer/subject

**Returns:**
- TokenExchangeRequest with JWT client assertion

**Raises:**
- `ValueError`: If auth_info doesn't contain "resource_client_id"


### `EKSWorkloadIdentity` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L399" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


EKS workload identity provider using mounted tokens.

This provider implements token exchange using EKS Pod Identity tokens that are
mounted into the pod's filesystem. The token file location is configured either
via initialization parameters or environment variables.

The token is read fresh on each token exchange request, allowing for token rotation
without requiring application restart.

Environment Variable Discovery (when token_file_path is not provided):
    1. KEYCARD_EKS_WORKLOAD_IDENTITY_TOKEN_FILE - Custom token file path (highest priority)
    2. AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE - AWS EKS default location
    3. AWS_WEB_IDENTITY_TOKEN_FILE - AWS fallback location


**Methods:**

#### `get_http_client_auth` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L546" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_http_client_auth(self) -> AuthStrategy
```

Get HTTP client authentication strategy.

Returns NoneAuth since EKSWorkloadIdentity uses client assertions in the request
body (EKS token) rather than HTTP client authentication.

**Returns:**
- NoneAuth instance for no HTTP client authentication


#### `set_client_config` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L557" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_client_config(self, config: ClientConfig, auth_info: dict[str, str]) -> ClientConfig
```

Configure OAuth client settings for EKS workload identity.

No additional configuration is needed for EKS workload identity as the
token is provided in the token exchange request itself.

**Args:**
- `config`: Base client configuration
- `auth_info`: Authentication context (unused for this provider)

**Returns:**
- Unmodified ClientConfig


#### `prepare_token_exchange_request` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/server/auth/application_credentials.py#L576" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
prepare_token_exchange_request(self, client: AsyncClient, subject_token: str, resource: str, auth_info: dict[str, str] | None = None) -> TokenExchangeRequest
```

Prepare token exchange request with EKS workload identity token.

Reads the EKS token from the filesystem and includes it as the client_assertion
in the token exchange request. The token is read fresh on each request to support
token rotation.

**Args:**
- `client`: OAuth client for token exchange
- `subject_token`: Access token to exchange
- `resource`: Target resource URL
- `auth_info`: Optional authentication context (unused for this provider)

**Returns:**
- TokenExchangeRequest with EKS token as client assertion

**Raises:**
- `EKSWorkloadIdentityRuntimeError`: If token cannot be read at runtime

