---
title: base
sidebarTitle: base
---

# `keycardai.mcp.client.auth.coordinators.base`


Authentication coordination for MCP clients.

## Classes

### `AuthCoordinator` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L24" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Abstract base for authentication coordination.

Facade coordinating authentication components:
- EndpointManager: HTTP redirect endpoints (local server or remote)
- AuthStateStorage: Pending auth state management
- CompletionRouter: Completion routing and handler invocation
- Subscribers: Observer notifications for completion events


**Methods:**

#### `storage` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L71" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
storage(self) -> NamespacedStorage
```

Get the coordinator's storage (for backward compatibility).

Returns the underlying storage used by state_store.


#### `endpoint_type` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L81" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
endpoint_type(self) -> str
```

Type of endpoint this coordinator uses.

**Returns:**
- "local" for LocalAuthCoordinator, "remote" for StarletteAuthCoordinator


#### `requires_synchronous_cleanup` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L91" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
requires_synchronous_cleanup(self) -> bool
```

Whether this coordinator requires synchronous callback cleanup.

Override in subclasses if they need cleanup to complete before
callback response (e.g., LocalAuthCoordinator needs this to avoid
race conditions with blocking wait patterns).

**Returns:**
- False by default (asynchronous cleanup is fine)


#### `create_context` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L104" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
create_context(self, context_id: str, metadata: dict[str, Any] | None = None) -> Context
```

Create or retrieve a context with properly scoped storage.

Idempotent - returns same Context instance for same context_id.

**Args:**
- `context_id`: Context identifier (e.g., "user\:alice" or just "alice")
- `metadata`: Optional metadata dict to attach to context (e.g., user info, session data)

**Returns:**
- Context instance with namespaced storage


#### `subscribe` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L131" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
subscribe(self, subscriber: CompletionSubscriber) -> None
```

Subscribe to completion notifications.


#### `unsubscribe` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L137" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
unsubscribe(self, subscriber: CompletionSubscriber) -> None
```

Unsubscribe from completion notifications.


#### `handle_completion` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L156" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
handle_completion(self, params: dict[str, str]) -> dict[str, Any]
```

Handle authentication completion using completion router.

Delegates to CompletionRouter which retrieves completion metadata from
storage and invokes the registered handler. Notifies subscribers of
the result.

**Args:**
- `params`: Completion parameters (e.g., {"code"\: "...", "state"\: "..."})

**Returns:**
- Dict with completion result including metadata

**Raises:**
- `ValueError`: If state is invalid or no handler registered


#### `set_auth_pending` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L205" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_auth_pending(self, context_id: str, server_name: str, auth_metadata: dict[str, Any], ttl: timedelta | None = None) -> None
```

Signal that authentication is pending for a server.

Delegates to AuthStateStorage for type-safe state management.

**Args:**
- `context_id`: Context identifier
- `server_name`: Server name requiring auth
- `auth_metadata`: Strategy-specific metadata (e.g., authorization_url, state)
- `ttl`: Optional expiration time


#### `get_auth_pending` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L228" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_auth_pending(self, context_id: str, server_name: str) -> dict[str, Any] | None
```

Get pending authentication metadata for a server.

Delegates to AuthStateStorage for type-safe state retrieval.

**Args:**
- `context_id`: Context identifier
- `server_name`: Server name to check

**Returns:**
- Auth metadata if pending, None otherwise


#### `clear_auth_pending` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L247" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
clear_auth_pending(self, context_id: str, server_name: str) -> None
```

Clear pending authentication state.

Delegates to AuthStateStorage for cleanup.

**Args:**
- `context_id`: Context identifier
- `server_name`: Server name


#### `register_completion_route` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L264" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
register_completion_route(self, routing_key: str, handler_name: str, storage_namespace: str, context_id: str, server_name: str, routing_param: str = 'state', handler_kwargs: dict[str, Any] | None = None, metadata: dict[str, Any] | None = None, ttl: timedelta | None = None) -> None
```

Register completion routing info for stateless execution.

Delegates to AuthStateStorage for type-safe route registration.

**Args:**
- `routing_key`: Key to route completion (e.g., OAuth state parameter value)
- `handler_name`: Name of registered completion handler (e.g., "oauth_completion")
- `storage_namespace`: Storage namespace path for strategy data
- `context_id`: Context identifier
- `server_name`: Server name for auth pending cleanup
- `routing_param`: Query parameter name for routing (default\: "state")
- `handler_kwargs`: Optional kwargs to pass to completion handler (e.g., client_factory)
- `metadata`: Optional metadata
- `ttl`: Expiration time


#### `get_redirect_uris` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L308" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_redirect_uris(self) -> list[str] | None
```

Get OAuth redirect URIs for this coordinator.

Delegates to EndpointManager. For coordinators with infrastructure
(e.g., local server), this may start it if not already running.

**Returns:**
- List of redirect URIs (e.g., ["http://localhost:8080/callback"])


#### `handle_redirect` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/client/auth/coordinators/base.py#L322" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
handle_redirect(self, authorization_url: str, metadata: dict[str, Any])
```

Handle user redirect to authorization URL.

**Args:**
- `authorization_url`: URL to redirect user to
- `metadata`: Flow metadata (e.g., server_name, state)

