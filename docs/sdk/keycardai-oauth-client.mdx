---
title: client
sidebarTitle: client
---

# `keycardai.oauth.client`


OAuth 2.0 client implementation following sync/async API design standard.

This module provides separate AsyncClient and Client classes with proper I/O separation,
sharing a sync-agnostic core as defined in the sync/async API design standard.


## Functions

### `resolve_endpoints`

```python
resolve_endpoints(base_url: str, endpoint_overrides: Endpoints | None = None, discovered_metadata: 'AuthorizationServerMetadata | None' = None) -> Endpoints
```


Resolve final endpoint URLs with priority: overrides > discovered > defaults.

**Args:**
- `base_url`: Base URL for OAuth 2.0 server
- `endpoint_overrides`: Optional endpoint overrides (highest priority)
- `discovered_metadata`: Optional discovered server metadata (middle priority)

**Returns:**
- Resolved endpoints configuration with proper priority handling


### `create_endpoints_summary`

```python
create_endpoints_summary(endpoints: Endpoints, base_url: str, endpoint_overrides: Endpoints | None = None, discovered_metadata: 'AuthorizationServerMetadata | None' = None) -> dict[str, dict[str, str]]
```


Create diagnostic summary of resolved endpoints showing their sources.

**Args:**
- `endpoints`: Resolved endpoints configuration
- `base_url`: Base URL for OAuth 2.0 server
- `endpoint_overrides`: Optional endpoint overrides
- `discovered_metadata`: Optional discovered server metadata

**Returns:**
- Dictionary showing resolved URLs and their sources (override/discovered/default)


## Classes

### `AsyncClient`


Asynchronous OAuth 2.0 client for async/await environments.

Must be used inside an event loop (asyncio). Provides native async I/O
operations for optimal performance in async applications.

This client implements the async context manager protocol and should be used
with 'async with' statements to ensure proper initialization and cleanup.

Automatically performs server metadata discovery (RFC 8414) and client
registration during context entry unless explicitly disabled via ClientConfig.


**Methods:**

#### `get_client_id`

```python
get_client_id(self) -> str | None
```

Get the client ID obtained from registration.

**Returns:**
- Client ID string if registration was successful, None otherwise

**Raises:**
- `RuntimeError`: If called outside of async context manager


#### `get_client_secret`

```python
get_client_secret(self) -> str | None
```

Get the client secret obtained from registration.

**Returns:**
- Client secret string if registration was successful, None otherwise

**Raises:**
- `RuntimeError`: If called outside of async context manager


#### `register_client`

```python
register_client(self, request: ClientRegistrationRequest) -> ClientRegistrationResponse
```

Register a new OAuth 2.0 client with the authorization server.

Simple usage (S2S):
    request = ClientRegistrationRequest(
        client_name="MyService",
        jwks_uri="https://zone1234.keycard.cloud/.well-known/jwks.json"
    )
    response = await client.register_client_async(request)

**Args:**
- `request`: ClientRegistrationRequest with all registration parameters

**Returns:**
- ClientRegistrationResponse with client credentials and metadata


#### `discover_server_metadata`

```python
discover_server_metadata(self, request: ServerMetadataRequest | None = None) -> AuthorizationServerMetadata
```

Discover OAuth 2.0 authorization server metadata.

**Args:**
- `request`: Optional ServerMetadataRequest (defaults to client's base_url if not provided)

**Returns:**
- AuthorizationServerMetadata with discovered server capabilities

**Raises:**
- `ConfigError`: If base_url is empty
- `OAuthHttpError`: If discovery endpoint is unreachable
- `OAuthProtocolError`: If metadata format is invalid
- `NetworkError`: If network request fails


#### `token_exchange`

```python
token_exchange(self, request: TokenExchangeRequest) -> TokenResponse
```

Perform OAuth 2.0 Token Exchange.

Simple usage (delegation):
    request = TokenExchangeRequest(
        subject_token="original_access_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com"
    )
    response = await client.token_exchange_async(request)

Advanced usage (impersonation):
    request = TokenExchangeRequest(
        subject_token="admin_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com",
        actor_token="service_token",
        actor_token_type="urn:ietf:params:oauth:token-type:access_token",
        requested_token_type="urn:ietf:params:oauth:token-type:access_token",
        scope="read write"
    )
    response = await client.token_exchange_async(request)

**Args:**
- `request`: TokenExchangeRequest with all exchange parameters

**Returns:**
- TokenResponse with the exchanged token and metadata


#### `access_token_for_resource`

```python
access_token_for_resource(self, resource: str, subject_token: str) -> str
```

Perform OAuth 2.0 Token Exchange.

Simple usage (delegation):
    request = TokenExchangeRequest(
        subject_token="original_access_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com"
    )
    response = await client.token_exchange_async(request)

Advanced usage (impersonation):
    request = TokenExchangeRequest(
        subject_token="admin_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com",
        actor_token="service_token",
        actor_token_type="urn:ietf:params:oauth:token-type:access_token",
        requested_token_type="urn:ietf:params:oauth:token-type:access_token",
        scope="read write"
    )
    response = await client.token_exchange_async(request)

**Args:**
- `request`: TokenExchangeRequest with all exchange parameters

**Returns:**
- TokenResponse with the exchanged token and metadata


#### `endpoints_summary`

```python
endpoints_summary(self) -> dict[str, dict[str, str]]
```

Get diagnostic summary of resolved endpoints.

**Returns:**
- Dictionary showing resolved URLs and their sources


### `Client`


Synchronous OAuth 2.0 client for traditional Python applications.

Uses blocking I/O (requests) and works in any Python environment without
requiring asyncio knowledge. Safe to use in Jupyter notebooks, GUIs, and
web servers with existing event loops.

Automatically performs server metadata discovery (RFC 8414) during first use
unless discovery is explicitly disabled via ClientConfig.


**Methods:**

#### `client_id`

```python
client_id(self) -> str | None
```

Client ID obtained from registration (lazily initialized).

Accessing this property will trigger automatic initialization if needed.

**Returns:**
- Client ID string if registration was successful, None otherwise


#### `client_secret`

```python
client_secret(self) -> str | None
```

Client secret obtained from registration (lazily initialized).

Accessing this property will trigger automatic initialization if needed.

**Returns:**
- Client secret string if registration was successful, None otherwise


#### `register_client`

```python
register_client(self, request: ClientRegistrationRequest) -> ClientRegistrationResponse
```

Register a new OAuth 2.0 client with the authorization server.

Simple usage (S2S):
    request = ClientRegistrationRequest(
        client_name="MyService",
        jwks_uri="https://zone1234.keycard.cloud/.well-known/jwks.json"
    )
    response = client.register_client(request)

**Args:**
- `request`: ClientRegistrationRequest with all registration parameters
- `timeout`: Optional timeout override (overrides request.timeout if provided)

**Returns:**
- ClientRegistrationResponse with client credentials and metadata


#### `discover_server_metadata`

```python
discover_server_metadata(self, request: ServerMetadataRequest | None = None) -> AuthorizationServerMetadata
```

Discover OAuth 2.0 authorization server metadata.

**Args:**
- `request`: Optional ServerMetadataRequest (defaults to client's base_url if not provided)
- `timeout`: Optional timeout override (overrides request.timeout if provided)

**Returns:**
- AuthorizationServerMetadata with discovered server capabilities

**Raises:**
- `ConfigError`: If base_url is empty
- `OAuthHttpError`: If discovery endpoint is unreachable
- `OAuthProtocolError`: If metadata format is invalid
- `NetworkError`: If network request fails


#### `token_exchange`

```python
token_exchange(self, request: TokenExchangeRequest) -> TokenResponse
```

Perform OAuth 2.0 Token Exchange.

Simple usage (delegation):
    request = TokenExchangeRequest(
        subject_token="original_access_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com"
    )
    response = client.token_exchange(request)

Advanced usage (impersonation):
    request = TokenExchangeRequest(
        subject_token="admin_token",
        subject_token_type="urn:ietf:params:oauth:token-type:access_token",
        audience="target-service.company.com",
        actor_token="service_token",
        actor_token_type="urn:ietf:params:oauth:token-type:access_token",
        requested_token_type="urn:ietf:params:oauth:token-type:access_token",
        scope="read write"
    )
    response = client.token_exchange(request)

**Args:**
- `request`: TokenExchangeRequest with all exchange parameters

**Returns:**
- TokenResponse with the exchanged token and metadata


#### `endpoints_summary`

```python
endpoints_summary(self) -> dict[str, dict[str, str]]
```

Get diagnostic summary of resolved endpoints.

**Returns:**
- Dictionary showing resolved URLs and their sources

