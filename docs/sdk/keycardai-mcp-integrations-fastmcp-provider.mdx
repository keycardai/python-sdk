---
title: provider
sidebarTitle: provider
---

# `keycardai.mcp.integrations.fastmcp.provider`


Keycard authentication provider for FastMCP.

This module provides AuthProvider, which integrates Keycard's OAuth
token verification with FastMCP's authentication system. The AuthProvider
creates a RemoteAuthProvider instance with automatic Keycard zone discovery
and JWT token verification.


## Classes

### `AccessContext` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L36" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Context object that provides access to exchanged tokens for specific resources.

Supports both successful token storage and per-resource error tracking,
allowing partial success scenarios where some resources succeed while others fail.


**Methods:**

#### `set_bulk_tokens` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L53" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_bulk_tokens(self, access_tokens: dict[str, TokenResponse])
```

Set access tokens for resources.


#### `set_token` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L57" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_token(self, resource: str, token: TokenResponse)
```

Set token for the specified resource.


#### `set_resource_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L63" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_resource_error(self, resource: str, error: dict[str, str])
```

Set error for a specific resource.


#### `set_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L69" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_error(self, error: dict[str, str])
```

Set error that affects all resources.


#### `has_resource_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L73" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_resource_error(self, resource: str) -> bool
```

Check if a specific resource has an error.


#### `has_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L77" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_error(self) -> bool
```

Check if there's a global error.


#### `has_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L81" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_errors(self) -> bool
```

Check if there are any errors (global or resource-specific).


#### `get_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L85" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_errors(self) -> dict[str, Any] | None
```

Get global errors if any.


#### `get_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L89" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_error(self) -> dict[str, str] | None
```

Get global error if any.


#### `get_resource_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L93" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_resource_errors(self, resource: str) -> dict[str, str] | None
```

Get error for a specific resource.


#### `get_status` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L97" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_status(self) -> str
```

Get overall status of the access context.


#### `get_successful_resources` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L106" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_successful_resources(self) -> list[str]
```

Get list of resources that have successful tokens.


#### `get_failed_resources` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L110" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_failed_resources(self) -> list[str]
```

Get list of resources that have errors.


#### `access` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L114" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
access(self, resource: str) -> TokenResponse
```

Get token response for the specified resource.

**Args:**
- `resource`: The resource URL to get token response for

**Returns:**
- TokenResponse object with access_token attribute

**Raises:**
- `ResourceAccessError`: If resource was not granted or has an error


### `AuthProvider` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L153" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Keycard authentication provider for FastMCP.

This provider integrates Keycard's zone-based authentication with FastMCP's
authentication system. It provides a clean interface for configuring Keycard
authentication and returns a RemoteAuthProvider instance for FastMCP integration.

Advanced use cases:
- If you want to customize the HTTP clients used in the discovery or token exchange, you can provide a custom client factory.


**Methods:**

#### `get_jwt_token_verifier` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L363" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_jwt_token_verifier(self) -> JWTVerifier
```

Create a JWT token verifier for Keycard zone tokens.

Discovers Keycard zone metadata and creates a JWTVerifier configured
with the zone's JWKS URI and issuer information.

This method uses eager discovery of the zone metadata, and performs HTTP calls using the initialized client.

**Returns:**
- Configured JWT token verifier for the Keycard zone

**Raises:**
- `MetadataDiscoveryError`: If zone metadata discovery fails
- `JWKSValidationError`: If JWKS URI is not available


#### `get_remote_auth_provider` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L385" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_remote_auth_provider(self) -> RemoteAuthProvider
```

Get a RemoteAuthProvider instance configured for Keycard authentication.

This method uses eager discovery of the zone metadata, and performs HTTP calls using the initialized client.

**Returns:**
- Configured authentication provider for use with FastMCP

**Raises:**
- `MetadataDiscoveryError`: If zone metadata discovery fails or JWKS URI is not available


#### `grant` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L406" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
grant(self, resources: str | list[str])
```

Decorator for automatic delegated token exchange.

This decorator automates the OAuth token exchange process for accessing
external resources on behalf of authenticated users. It follows the FastMCP
Context namespace pattern, making tokens available through ctx.get_state("keycardai").

The returned value is an instance of AccessContext, which can be used to check the status of the token exchange

The decorator avoids raising exceptions, and instead sets the error state in the AccessContext.

**Args:**
- `resources`: Target resource URL(s) for token exchange.
      Can be a single string or list of strings.
      (e.g., "https\://api.example.com" or
       ["https\://api.example.com", "https\://other-api.com"])

The decorated function must:
- Have a Context parameter from FastMCP (e.g., `ctx: Context`)
- Can be either async or sync (the decorator handles both cases automatically)

**Raises:**
- `MissingContextError`: If the decorated function doesn't have a Context parameter
                or if Context cannot be found in function arguments at runtime

Error handling:
- Returns structured error response if token exchange fails
- Preserves original function signature and behavior
- Provides detailed error messages for debugging

