---
title: provider
sidebarTitle: provider
---

# `keycardai.mcp.integrations.fastmcp.provider`


Keycard authentication provider for FastMCP.

This module provides AuthProvider, which integrates Keycard's OAuth
token verification with FastMCP's authentication system. The AuthProvider
creates a RemoteAuthProvider instance with automatic Keycard zone discovery
and JWT token verification.


## Functions

### `introspect` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L54" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
introspect(self, message, *args, **kwargs)
```


Log at INTROSPECT level - most detailed debugging including token info.


### `get_token_debug_info` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L83" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_token_debug_info(access_token: str) -> dict[str, Any]
```


Extract non-sensitive debugging information from a JWT access token.

This function safely extracts only non-sensitive claims from a JWT token
for debugging and logging purposes. It does NOT verify the token signature
and only returns issuer, audience, subject, and scope information.

**Important:** This is a debug function that NEVER raises exceptions. If token
parsing fails, it returns an error indicator in the result dict instead.

**Security Note:** This function is designed for internal debugging and logging.
While it includes subject (user identifier), it excludes:
- The actual token string
- Custom claims that might contain PII

**Args:**
- `access_token`: JWT access token string (without Bearer prefix)

**Returns:**
- Dictionary with token information:
- - issuer (str): Token issuer (if present)
- - audience (str | list\[str]): Token audience (if present)
- - subject (str): Token subject/user identifier (if present)
- - expires_at (int): Token expiration time as Unix timestamp (if present)
- - issued_at (int): Token issuance time as Unix timestamp (if present)
- - scopes (list\[str]): List of scopes from the token (if present)
- - error (str): Error message if token parsing failed


## Classes

### `AccessContext` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L148" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Context object that provides access to exchanged tokens for specific resources.

Supports both successful token storage and per-resource error tracking,
allowing partial success scenarios where some resources succeed while others fail.


**Methods:**

#### `set_bulk_tokens` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L165" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_bulk_tokens(self, access_tokens: dict[str, TokenResponse])
```

Set access tokens for resources.


#### `set_token` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L169" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_token(self, resource: str, token: TokenResponse)
```

Set token for the specified resource.


#### `set_resource_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L175" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_resource_error(self, resource: str, error: dict[str, str])
```

Set error for a specific resource.


#### `set_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L181" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
set_error(self, error: dict[str, str])
```

Set error that affects all resources.


#### `has_resource_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L185" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_resource_error(self, resource: str) -> bool
```

Check if a specific resource has an error.


#### `has_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L189" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_error(self) -> bool
```

Check if there's a global error.


#### `has_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L193" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_errors(self) -> bool
```

Check if there are any errors (global or resource-specific).


#### `get_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L197" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_errors(self) -> dict[str, Any] | None
```

Get global errors if any.


#### `get_error` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L201" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_error(self) -> dict[str, str] | None
```

Get global error if any.


#### `get_resource_errors` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L205" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_resource_errors(self, resource: str) -> dict[str, str] | None
```

Get error for a specific resource.


#### `get_status` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L209" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_status(self) -> str
```

Get overall status of the access context.


#### `get_successful_resources` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L218" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_successful_resources(self) -> list[str]
```

Get list of resources that have successful tokens.


#### `get_failed_resources` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L222" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_failed_resources(self) -> list[str]
```

Get list of resources that have errors.


#### `access` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L226" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
access(self, resource: str) -> TokenResponse
```

Get token response for the specified resource.

**Args:**
- `resource`: The resource URL to get token response for

**Returns:**
- TokenResponse object with access_token attribute

**Raises:**
- `ResourceAccessError`: If resource was not granted or has an error


### `AuthProvider` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L265" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


Keycard authentication provider for FastMCP.

This provider integrates Keycard's zone-based authentication with FastMCP's
authentication system. It provides a clean interface for configuring Keycard
authentication and returns a RemoteAuthProvider instance for FastMCP integration.

Advanced use cases:
- If you want to customize the HTTP clients used in the discovery or token exchange, you can provide a custom client factory.


**Methods:**

#### `get_jwt_token_verifier` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L532" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_jwt_token_verifier(self) -> JWTVerifier
```

Create a JWT token verifier for Keycard zone tokens.

Creates a JWTVerifier configured with the zone's JWKS URI and issuer
information that was discovered during AuthProvider initialization.

Note: Zone metadata discovery happens in __init__. This method only
creates the verifier object with already-discovered values.

**Returns:**
- Configured JWT token verifier for the Keycard zone


#### `get_remote_auth_provider` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L551" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_remote_auth_provider(self) -> RemoteAuthProvider
```

Get a RemoteAuthProvider instance configured for Keycard authentication.

Creates a RemoteAuthProvider using the zone configuration that was
discovered and validated during AuthProvider initialization.

Note: Zone metadata discovery and validation happens in __init__. This method
only creates the RemoteAuthProvider object with already-validated configuration.

**Returns:**
- Configured authentication provider for use with FastMCP


#### `grant` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/mcp/integrations/fastmcp/provider.py#L573" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
grant(self, resources: str | list[str])
```

Decorator for automatic delegated token exchange.

This decorator automates the OAuth token exchange process for accessing
external resources on behalf of authenticated users. It follows the FastMCP
Context namespace pattern, making tokens available through ctx.get_state("keycardai").

The returned value is an instance of AccessContext, which can be used to check the status of the token exchange

The decorator avoids raising exceptions, and instead sets the error state in the AccessContext.

**Args:**
- `resources`: Target resource URL(s) for token exchange.
      Can be a single string or list of strings.
      (e.g., "https\://api.example.com" or
       ["https\://api.example.com", "https\://other-api.com"])

The decorated function must:
- Have a Context parameter from FastMCP (e.g., `ctx: Context`)
- Can be either async or sync (the decorator handles both cases automatically)

**Raises:**
- `MissingContextError`: If the decorated function doesn't have a Context parameter
                or if Context cannot be found in function arguments at runtime

Error handling:
- Returns structured error response if token exchange fails
- Preserves original function signature and behavior
- Provides detailed error messages for debugging

