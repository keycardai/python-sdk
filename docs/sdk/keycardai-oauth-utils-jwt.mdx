---
title: jwt
sidebarTitle: jwt
---

# `keycardai.oauth.utils.jwt`


JWT Profile for OAuth 2.0 implementations (RFC 7523, RFC 9068).

This module implements JWT-related OAuth 2.0 profiles for secure token handling,
including JWT client assertions and JWT access token profiles.

RFC 7523: JSON Web Token (JWT) Profile for OAuth 2.0 Client Authentication
and Authorization Grants
https://datatracker.ietf.org/doc/html/rfc7523

RFC 9068: JSON Web Token (JWT) Profile for OAuth 2.0 Access Tokens
https://datatracker.ietf.org/doc/html/rfc9068

Key Features:
- JWT client authentication (RFC 7523)
- JWT authorization grants (RFC 7523)
- JWT access token format (RFC 9068)
- Claims validation and verification
- Signature verification and key management

JWT Client Authentication Use Cases:
- High-security environments requiring cryptographic authentication
- Distributed systems with pre-shared keys or certificates
- Service-to-service authentication
- Environments where client secrets are not practical

JWT Access Token Benefits:
- Self-contained tokens with embedded claims
- Cryptographic integrity protection
- Reduced database lookups for token validation
- Standardized claim format across services


## Functions

### `get_claims` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L94" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_claims(jwt_token: str) -> dict[str, Any]
```


Extract all claims from a JWT token payload without verification.

This utility extracts all claims from a JWT token's payload without
performing signature verification. Useful for operational purposes
like extracting specific claims for token exchange requests.

**Args:**
- `jwt_token`: JWT token string (without Bearer prefix)

**Returns:**
- Dictionary of all claims in the JWT payload

**Raises:**
- `ValueError`: If token is malformed or cannot be decoded


### `get_header` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L132" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_header(jwt_token: str) -> dict[str, Any]
```


Extract header information from a JWT token without verification.

This utility extracts header information from a JWT token including
algorithm, key ID, and other header claims.

**Args:**
- `jwt_token`: JWT token string (without Bearer prefix)

**Returns:**
- Dictionary of all header claims in the JWT

**Raises:**
- `ValueError`: If token is malformed or cannot be decoded


### `extract_scopes` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L172" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
extract_scopes(claims: dict[str, Any]) -> list[str]
```


Extract scopes from JWT token claims.

Supports both 'scope' (space-separated string) and 'scp' (list) claims
as commonly used in OAuth 2.0 JWT access tokens.

**Args:**
- `claims`: JWT token claims dictionary

**Returns:**
- List of scope strings


### `decode_and_verify_jwt` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L364" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
decode_and_verify_jwt(jwt_token: str, verification_key: str, algorithm: str = 'RS256') -> dict
```


Decode and verify JWT token signature using authlib.

**Args:**
- `jwt_token`: JWT token string (without Bearer prefix)
- `verification_key`: Public key for verification (PEM format)
- `algorithm`: JWT algorithm (default RS256)

**Returns:**
- Verified JWT claims dictionary

**Raises:**
- `ValueError`: If token is invalid, malformed, or signature verification fails


### `parse_jwt_access_token` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L388" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
parse_jwt_access_token(jwt_token: str, verification_key: str, algorithm: str = 'RS256') -> JWTAccessToken
```


Parse a JWT token into a JWTAccessToken model with signature verification.

This function decodes and verifies the JWT token signature, then creates a
structured JWTAccessToken model instance. Supports custom claims and
preserves the original token.

**Args:**
- `jwt_token`: JWT token string (without Bearer prefix)
- `verification_key`: Public key for verification (PEM format)
- `algorithm`: JWT algorithm (default RS256)

**Returns:**
- JWTAccessToken model instance with verified claims

**Raises:**
- `ValueError`: If token is malformed, signature invalid, or missing required claims


### `get_verification_key` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L460" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_verification_key(token: str, jwks_uri: str) -> str
```


Get the verification key for a JWT token from JWKS.

**Args:**
- `token`: JWT token string
- `jwks_uri`: JWKS endpoint URL for key fetching

**Returns:**
- Public key for verification (PEM format)

**Raises:**
- `ValueError`: If key cannot be obtained or token is malformed


### `get_jwks_key` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L483" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_jwks_key(kid: str | None, jwks_uri: str) -> str
```


Fetch key from JWKS endpoint.

**Args:**
- `kid`: Key ID from JWT header (optional)
- `jwks_uri`: JWKS endpoint URL

**Returns:**
- Public key for verification (PEM format)

**Raises:**
- `ValueError`: If JWKS cannot be fetched or key not found


## Classes

### `JWTAccessToken` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L204" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>


JWT Access Token profile implementing RFC 9068.

Defines the standard claims and structure for JWT-formatted access tokens
as specified in RFC 9068. Supports custom claims and preserves the raw token.

Reference: https://datatracker.ietf.org/doc/html/rfc9068#section-2


**Methods:**

#### `get_custom_claim` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L234" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_custom_claim(self, claim_name: str, default: Any = None) -> Any
```

Get a custom claim value.

**Args:**
- `claim_name`: Name of the custom claim
- `default`: Default value if claim not found

**Returns:**
- Custom claim value or default


#### `has_custom_claim` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L246" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
has_custom_claim(self, claim_name: str) -> bool
```

Check if a custom claim exists.

**Args:**
- `claim_name`: Name of the custom claim

**Returns:**
- True if the custom claim exists, False otherwise


#### `get_all_claims` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L257" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_all_claims(self) -> dict[str, Any]
```

Get all claims (standard + custom) as a dictionary.

**Returns:**
- Dictionary containing all token claims


#### `validate_audience` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L285" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
validate_audience(self, expected_audience: str | dict[str, str] | None, zone_id: str | None = None) -> bool
```

Validate the token's audience claim against expected values.

**Args:**
- `expected_audience`: Expected audience configuration. Can be\:
- str\: Single audience value for all zones
- dict\[str, str]\: Zone-specific audience mapping (zone_id -> audience)
- None\: Skip audience validation
- `zone_id`: Zone ID for multi-zone scenarios (required when expected_audience is dict)

**Returns:**
- True if audience is valid, False otherwise


#### `validate_scopes` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L334" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
validate_scopes(self, required_scopes: list[str] | None) -> bool
```

Validate the token's scope claim against required scopes.

**Args:**
- `required_scopes`: List of required scopes that must be present in the token.
           If None or empty, scope validation is skipped.

**Returns:**
- True if all required scopes are present in the token, False otherwise


#### `get_scopes` <sup><a href="https://github.com/keycardai/python-sdk/blob/main/src/keycardai/oauth/utils/jwt.py#L355" target="_blank"><Icon icon="github" style="width: 14px; height: 14px;" /></a></sup>

```python
get_scopes(self) -> list[str]
```

Get the token's scopes as a list.

**Returns:**
- List of scopes from the token. Empty list if no scopes present.

